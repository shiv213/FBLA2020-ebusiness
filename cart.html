<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Classic - Cart</title>
    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon-16x16.png">
    <link rel="manifest" href="assets/site.webmanifest">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kaushan+Script">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="assets/fonts/fontawesome5-overrides.min.css">
    <link rel="stylesheet" href="assets/css/Article-List.css">
    <link rel="stylesheet" href="assets/css/clean-responsive-pricing.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.8.2/css/lightbox.min.css">
    <link rel="stylesheet" href="assets/css/Lightbox-Gallery.css">
    <link rel="stylesheet" href="assets/css/MUSA_carousel-product-cart-slider.css">
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-analytics.js"></script>
    <script src="assets/js/firebase.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://checkout.stripe.com/checkout.js"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>
</head>

<body>
<nav class="navbar navbar-dark navbar-expand-lg fixed-top bg-dark" id="mainNav">
    <div class="container">
        <button data-toggle="collapse" data-target="#navbarResponsive" class="navbar-toggler navbar-toggler-right"
                type="button" data-toogle="collapse" aria-controls="navbarResponsive" aria-expanded="false"
                aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
        <a href="index.html"><img src="assets/img/logo.svg" style="height: 50px;" alt=""></a>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="nav navbar-nav ml-auto text-uppercase">
                <li class="nav-item" role="presentation"><a class="nav-link js-scroll-trigger" href="index.html#about">About</a>
                </li>
                <li class="nav-item" role="presentation"><a class="nav-link js-scroll-trigger"
                                                            href="index.html#gallery">Gallery</a></li>
                <li class="nav-item" role="presentation"><a class="nav-link js-scroll-trigger" href="index.html#plans">PRICING</a>
                </li>
                <li class="nav-item" role="presentation"><a class="nav-link js-scroll-trigger" href="index.html#team">Team</a>
                </li>
                <li class="nav-item" role="presentation"><a class="nav-link js-scroll-trigger" href="cart.html">CART</a>
                </li>
                <li class="nav-item" id="logoutNav" role="presentation" hidden>
                    <a class="nav-link js-scroll-trigger" onclick="logOut()" href="#">LOGOUT</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" href="account.html">
                        <i class="fas fa-user"></i>
                        <img style="border-radius: 50%;" id="profileImg" src="" alt=""/>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<header class="masthead" style="background-image: url('assets/img/mainbg.jpeg');">
    <div class="container">
    </div>
</header>
<section id="about" style="padding: 150px 0px;padding-bottom: 25px;padding-top: 100px;">
    <div class="container">
        <div style="margin: auto; max-width: 500px; padding: 20px; text-align: center;">
            <form id="form">
                <button class="btn btn-lg btn-block btn-primary" id="checkout">Checkout</button>
                <div id="error" style="color: #e2000b;"></div>
            </form>
            <div id="thanks" style="display: none;">Thanks for your purchase!</div>
        </div>
    </div>
</section>

<script>
    const STRIPE_PUBLIC_KEY = 'pk_test_dp1iIfRSs8UTNkWCUC5rSewl00WkpyaPDr'; // TODO: PUT YOUR STRIPE PUBLISHABLE KEY HERE
    const FIREBASE_FUNCTION = 'https://us-central1-fbla-ebusiness2020.cloudfunctions.net/charge'; // TODO: PUT YOUR FIREBASE FUNCTIONS URL HERE
    const stripe = Stripe(STRIPE_PUBLIC_KEY);
    const charge_amount = 1;
    const charge_currency = 'usd';
    const charge_description = "INSERT ORDER OVERVIEW HERE";
    const elForm = document.getElementById('form');
    const elCheckout = document.getElementById('checkout');
    const elError = document.getElementById('error');
    const elThanks = document.getElementById('thanks');

    addCheckoutMethod();

    function addCheckoutMethod() {
        const handler = StripeCheckout.configure({
            key: STRIPE_PUBLIC_KEY,
            locale: 'auto',
            token: async token => {
                // Pass the received token to our Firebase function
                let res = charge(token, charge_amount, charge_currency);
                if (res.body.error) {
                    console.log(res.body.error);
                }

                // Card successfully charged
                elForm.style.display = 'none';
                elThanks.style.display = 'block';
                console.log(user.email);
                Email.send({
                    SecureToken: 'a8f0ceb1-d3f7-48dd-9831-4c84d158425c',
                    To: user.email,
                    From: 'contact@shivvtrivedi.com',
                    Subject: 'Thank you for your purchase!',
                    Body: `Thank you for your purchase of $${(charge_amount / 100).toFixed(2)} at Classic. <br> -The Classic Team`
                }).then(
                    // alert('Sent! Check your email!')
                );

            }
        });

        elCheckout.addEventListener('click', e => {
            e.preventDefault();
            if (user) {
                handler.open({
                    name: 'Classic - Checkout',
                    description: charge_description,
                    amount: charge_amount,
                    currency: charge_currency,
                    email: user.email
                    // receipt_email: email,
                });
            } else {
                window.location.href = "account.html?checkout=true";
            }
        });

        // Close Checkout on page navigation
        window.addEventListener('popstate', () => handler.close());
    }

    async function charge(token, amount, currency) {
        const res = await fetch(FIREBASE_FUNCTION, {
            method: 'POST',
            body: JSON.stringify({
                token,
                charge: {
                    amount,
                    currency,
                },
            }),
        });
        const data = await res.json();
        data.body = JSON.parse(data.body);
        return data;
    }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
<script src="assets/js/agency.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.8.2/js/lightbox.min.js"></script>
</body>

</html>